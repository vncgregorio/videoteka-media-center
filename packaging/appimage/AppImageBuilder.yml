version: 1
script:
  - mkdir -p $APPDIR/usr/bin
  - mkdir -p $APPDIR/usr/share/videoteka
  - mkdir -p $APPDIR/usr/share/applications
  - mkdir -p $APPDIR/usr/share/icons/hicolor/256x256/apps
  
  # Copy application files
  - cp -r $RECIPE_DIR/../../src $APPDIR/usr/share/videoteka/
  - cp -r $RECIPE_DIR/../../data $APPDIR/usr/share/videoteka/ || true
  
  # Create launcher script
  - |
    cat > $APPDIR/usr/bin/videoteka << 'EOF'
    #!/bin/bash
    cd "$(dirname "$0")/../share/videoteka"
    export PYTHONPATH="$APPDIR/usr/share/videoteka:$PYTHONPATH"
    python3 -m src.main "$@"
    EOF
  - chmod +x $APPDIR/usr/bin/videoteka
  
  # Create desktop file
  - |
    cat > $APPDIR/usr/share/applications/videoteka.desktop << 'EOF'
    [Desktop Entry]
    Type=Application
    Name=Videoteka Media Center
    Comment=A desktop media center application for Linux
    Exec=videoteka
    Icon=videoteka
    Categories=AudioVideo;Video;Audio;
    Terminal=false
    EOF
  
  # Copy icon (if exists)
  - cp $RECIPE_DIR/../../src/resources/icons/*.png $APPDIR/usr/share/icons/hicolor/256x256/apps/videoteka.png 2>/dev/null || true

AppDir:
  path: appimage-build/AppDir
  
  app_info:
    id: org.videoteka.mediacenter
    name: Videoteka Media Center
    icon: videoteka
    version: 0.1.0
    exec: videoteka
    exec_args: $@

  apt:
    arch: amd64
    sources:
      - sourceline: 'deb [arch=amd64] http://archive.ubuntu.com/ubuntu/ jammy main restricted universe multiverse'
        key_url: 'http://keyserver.ubuntu.com/pks/lookup?op=get&search=0x3b4fe6acc0b21f32'
    packages:
      - python3
      - python3-pip
      - python3-venv
      - libqt6gui6
      - libqt6widgets6
      - libqt6core6
      - libqt6multimedia6
      - libgl1-mesa-glx
      - libglib2.0-0
      - libgstreamer1.0-0
      - libgstreamer-plugins-base1.0-0
      - ffmpeg
      - libopencv-dev
      - libxcb-cursor0
      - libxcb-xinerama0
      - libxcb-xfixes0
      - libxcb-render0
      - libxcb-shape0

  python:
    version: 3.11
    pip_requirements: $RECIPE_DIR/../../requirements.txt

  files:
    exclude:
      - usr/share/man
      - usr/share/doc/*/README.*
      - usr/share/doc/*/changelog.*
      - usr/share/doc/*/copyright
      - usr/share/doc/*/NEWS.*
      - usr/share/doc/*/AUTHORS.*

  test:
    command: videoteka --version || true


